<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Disasters Near Me</title>
    <link rel="icon" type="image/x-icon" href="../img/favicon.ico" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />

    <!-- Datatables for table styling -->
    <link
      href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />

    <!-- Datatables JS scripts -->
    <script defer src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"
    ></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"
    ></script>
    <script defer src="../script.js"></script>
  </head>

  <body>
    <div id="app">
      <!-- MODAL to check in on a disaster stricken user within 10km of disaster -->
      <div
        v-if="this.userStatus_level != 'safe'"
        class="modal"
        tabindex="-1"
        id="checkInModal"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Please report your safety</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p>
                Based on your location, it appears that you may be caught in
                {{alert.name}}.
                <b>What is your current status?</b>
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-primary acknowledgeButton"
                data-bs-dismiss="modal"
                id="liveToastBtn1"
              >
                Safe
              </button>
              <button
                type="button"
                class="btn btn-outline-primary acknowledgeButton"
                data-bs-dismiss="modal"
                id="liveToastBtn2"
              >
                Injured
              </button>
              <!-- <button type="button" class="btn btn-outline-primary acknowledgeButton" data-bs-dismiss="modal"
              id="liveToastBtn3">Severely Injured</button> -->
            </div>
          </div>
        </div>
      </div>

      <!-- SUBMISSION TOAST -->
      <div
        v-for="status in statusArr"
        class="toast-container position-fixed bottom-0 end-0 p-3"
      >
        <div
          :id="status"
          class="toast"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="toast-header">
            <strong class="me-auto">Your response has been recorded</strong>
            <small>Just now</small>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="toast"
              aria-label="Close"
            ></button>
          </div>
          <div class="toast-body">
            We have informed the government and your family on your status!
          </div>
        </div>
      </div>

      <!-- NAVBAR-->
      <nav
        class="navbar navbar-light navbar-expand-lg bg-body-secondary"
        style="background-color: #e3f2fd"
      >
        <div class="container-fluid">
          <!-- Shows account type -->
          <a class="navbar-brand" href="disastersNearMe.html"
            >SafeMe (Public)</a
          >

          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <!-- Navbar tabs for Public UI -->
              <li class="nav-item">
                <a
                  class="nav-link active"
                  aria-current="page"
                  href="disastersNearMe.html"
                  >Disasters Near Me</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="myFamily.html">My Family</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="volunteerPublic.html"
                  >Volunteer to Help</a
                >
              </li>
            </ul>

            <!-- Switches between account types -->
            <button
              class="btn btn-outline-primary"
              onclick="location.href='../gov/countryDisasters.html'"
            >
              Switch to Government (for demo purpose)
            </button>
          </div>
        </div>
      </nav>

      <!-- DISASTER TABLE -->
      <div class="container my-5">
        <table
          id="datatable"
          class="table table-striped my-auto"
          style="width: 100%"
        >
          <thead>
            <tr>
              <th>Country, City</th>
              <th>Disaster Name</th>
              <th>Distance Away</th>
              <th>Time of Incident</th>
              <th>Impact Level</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="disaster in this.disaster_table">
              <td>{{disaster.country}}, {{disaster.city}}</td>
              <td>{{disaster.disasterName}}</td>
              <td>{{disaster.distance}} km</td>
              <td>{{disaster.disasterTimestamp}}</td>
              <!-- Checks for danger status and renders the colour status -->
              <td v-if="disaster.disasterSeverityLevel == 'green'">
                <span class="badge text-bg-success">Low</span>
              </td>
              <td v-else-if="disaster.disasterSeverityLevel == 'amber'">
                <span class="badge text-bg-warning">Medium</span>
              </td>
              <td v-else-if="disaster.disasterSeverityLevel == 'red'">
                <span class="badge text-bg-danger">High</span>
              </td>
              <td v-else>
                <span class="badge text-bg-secondary">None</span>
              </td>
            </tr>
          </tbody>
        </table>
        <br />
        <br />
        <div>
          <form @submit.prevent="submitForm">
            <label for="userID">User ID:</label>
            <input type="number" id="userID" v-model="form.userID" /><br />

            <label for="lat">Latitude:</label>
            <input type="text" id="lat" v-model="form.lat" /><br />

            <label for="long">Longitude:</label>
            <input type="text" id="long" v-model="form.long" /><br />

            <label for="country">Country:</label>
            <input type="text" id="country" v-model="form.country" /><br />

            <label for="city">City:</label>
            <input type="text" id="city" v-model="form.city" /><br />

            <button type="submit">Submit</button>
          </form>
          <button @click="sendWebSocketMessage()">
            subscribe websocket
          </button>
        </div>
      </div>
    </div>
    <script>
      // Hardcoded userID for now
      const userID = 1;
      const disaster_URL = "http://localhost:8000/api/disaster/disaster";
      const user_location_URL =
        "http://localhost:8000/api/user/location/" + userID;
      const volunteer_URL =
        "http://localhost:8000/api/volunteerevent/volunteer/event";

      const app = Vue.createApp({
        data() {
          return {
            header: "Disasters Near Me",
            // Danger threshold
            dangerThreshold: 10,
            form: {
              userID: "",
              lat: "",
              long: "",
              country: "",
              city: "",
              timestamp: "",
            },
            //Available statuses for dynamic toasts
            statusArr: ["okay", "mildlyInjured", "severelyInjured"],
            userID: 1,
            disaster_table: [
              {
                danger: "-",
                distance: 0.0,
              },
            ],
            status: "Unavailable",
            user_lat: 0.0,
            user_long: 0.0,
            userStatus_level: "Not Okay",
            alert: {
              name: "Nil",
            },
          };
        },

        methods: {
          // status
          getStatus(status) {
            return status;
          },

          
      }
    });
      app.mount("#app");
    </script>

    <!-- Bootstrap Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
  </body>
</html>